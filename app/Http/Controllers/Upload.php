<?phpnamespace App\Http\Controllers;use Illuminate\Http\Request;use App\Http\Controllers\Controller;use App\Helper\Custom;use DB, File;class Upload extends Controller{	public function __construct()	{		parent::__construct();	}			public function upload(Request $request)	{		$fields = json_decode($request->array);		$image = time().'.'.$request->file->getClientOriginalExtension();		$field_name = $fields->field;		if($fields->formType == "edit") {            $record = DB::table($fields->table)->where('id', $fields->id)->first();			//if($record->$field_name) $image = $record->$field_name;        } 		if(isset($record) && File::isFile($fields->dir.$record->$field_name)){			\File::delete($fields->dir.$record->$field_name);		}		$result = upload_image(array(			"file" => $request->file,			"dir" => $fields->dir,			"name" => $image,			"width" => (isset($fields->width) ? $fields->width : NULL),			"height" => (isset($fields->height) ? $fields->height : NULL),		)); 		if(isset($fields->sizes)) {			foreach($fields->sizes as $size) {				if(isset($record) && File::isFile($fields->dir.$size.'/'.$record->$field_name)){					\File::delete($fields->dir.$size.'/'.$record->$field_name);				}				$values = explode('x',$size);				$result = upload_image(array(					"file" => $request->file,					"dir" => $fields->dir.$size.'/',					"name" => $image,					"width" => (isset($values[0]) ? $values[0] : NULL),					"height" => (isset($values[1]) ? $values[1] : NULL),				)); 			}		} 		DB::table($fields->table)->where('id', $fields->id)->update([			$field_name => $image		]);		$this->json_array['image'] = $image;		$this->json_array['src'] = url($fields->dir.$image);		return json_encode($this->json_array);	}}